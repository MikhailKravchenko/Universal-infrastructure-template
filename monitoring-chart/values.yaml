# Глобальные настройки
global:
  namespace: monitoring

# Alertmanager: приём алертов от Prometheus. Настройка Slack/email — в alertmanager.config или в docs/runbook.md
alertmanager:
  enabled: true
  configOverride: null  # при необходимости задайте full config (global, route, receivers) для Slack/email

# Prometheus настройки
prometheus:
  alertmanagerUrl: "http://alertmanager:9093"  # включить отправку алертов в Alertmanager
  enabled: true
  image:
    repository: prom/prometheus
    tag: latest
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 1Gi
  
  service:
    type: NodePort
    port: 9090
    nodePort: 32090
  
  # Настройки сбора метрик
  scrapeInterval: 10s
  scrapeTimeout: 10s
  
  # Yandex Cloud сервисы (если нужны)
  yandex_cloud_services: []
  
  persistence:
    enabled: true
    size: 20Gi
    storageClassName: "local-path"  # StorageClass для RKE2

# Grafana настройки
grafana:
  enabled: true
  image:
    repository: grafana/grafana
    tag: "8.4.4"
    pullPolicy: IfNotPresent
  
  adminUser: admin
  adminPassword: admin
  
  service:
    type: NodePort
    port: 3000
    nodePort: 32300
  
  resources:
    requests:
      cpu: 250m
      memory: 750Mi
    limits:
      cpu: 500m
      memory: 1Gi
  
  persistence:
    enabled: true
    size: 10Gi
    storageClassName: "local-path"  # StorageClass для RKE2

# Loki настройки
loki:
  enabled: true
  image:
    repository: grafana/loki
    tag: "2.9.0"
    pullPolicy: IfNotPresent
  
  service:
    type: NodePort
    port: 3100
    nodePort: 32310
  
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  
  storage:
    type: pvc
    size: 20Gi
    storageClassName: "local-path"  # StorageClass для RKE2

# Promtail настройки
promtail:
  enabled: true
  image:
    repository: grafana/promtail
    tag: "2.9.0"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  
  loki:
    url: "http://loki:3100/loki/api/v1/push"
  
  scrapeConfigs:
    - job_name: kubernetes-pods
      kubernetes_sd_configs:
        - role: pod
      pipeline_stages:
        - cri: {}
      relabel_configs:
        - source_labels:
            - __meta_kubernetes_pod_node_name
          target_label: __host__
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
        - action: replace
          source_labels:
            - __meta_kubernetes_namespace
          target_label: namespace
        - action: replace
          source_labels:
            - __meta_kubernetes_pod_name
          target_label: pod
        - action: replace
          source_labels:
            - __meta_kubernetes_pod_container_name
          target_label: container
        - action: replace
          source_labels:
            - __meta_kubernetes_namespace
            - __meta_kubernetes_pod_name
            - __meta_kubernetes_pod_uid
          separator: _
          target_label: __meta_kubernetes_pod_path
        - action: replace
          source_labels:
            - __meta_kubernetes_pod_path
            - __meta_kubernetes_pod_container_name
          separator: /
          target_label: __path__
          replacement: /var/log/pods/$1/*.log
        - source_labels:
            - __meta_kubernetes_pod_node_name
          target_label: node_name
